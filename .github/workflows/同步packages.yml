name: 同步 packages

on: [push]

jobs:
  get_openwrt_packages:
    name: 处理packages文件
    runs-on: [macos-latest]
    steps:
      - uses: actions/checkout@v1
      - name: Git Clone
        run: |
          git clone https://git.openwrt.org/feed/packages.git packagestem
          ls -al
      - name: 清理git配置文件
        run: |
          cd packagestem
          rm -rf .git LICENSE
          ls -al
  get_packages:
    name: 同步packages
    runs-on: [macos-latest]
    steps:
    - uses: actions/checkout@v1
    - name: 初始化Git
      env:
        ACTION_DEPLOY_KEY: ${{ secrets.ID_RSA }}
      run: |
        mkdir -p ~/.ssh
        git config --global user.email "76885266@qq.com"
        git config --global user.name "Ouiae"
        echo "$ACTION_DEPLOY_KEY" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        #ssh-keygen -R gitee.com
        ssh-keyscan gitee.com >> ~/.ssh/known_hosts
    - name: 拉取项目文件
      run: |
        git clone git@gitee.com:ouiae/packages.git
        cd packages
        ls -al
    - name: 移动packages文件
      run: |
        mv -f packagestem/* packages/
    - name: 同步文件
      run: |
        cd packages
        git add .
        git commit -m "first commit"
        git pull -f
